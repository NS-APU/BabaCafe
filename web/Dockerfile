# prepare svelte project
# make,python3,g++ -> node-gyp required
FROM node:16.6.1-slim AS prepare
WORKDIR /svelte_app
ENV LIB="git curl wget make python3 g++"
RUN apt update \
  && apt install -y $LIB --no-install-recommends
COPY app/package.json app/yarn.lock ./
RUN yarn install
COPY app ./

# build svelte app
FROM prepare AS builder
RUN yarn build

# nginx(product)
FROM nginx:stable AS product
WORKDIR /var/www/html
COPY ./nginx.conf /etc/nginx/conf.d/default.conf
COPY --from=builder /svelte_app/dist ./
